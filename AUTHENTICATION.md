# üîê Authentication Guide

This document explains the authentication system for the Camera Capture System web interface.

## üéØ Overview

The system includes **password-based authentication** to protect your web interface and captured images from unauthorized access.

### Features

- ‚úÖ **Session-based authentication** - Secure login sessions
- ‚úÖ **Password hashing** - Bcrypt encryption (never stores plain text)
- ‚úÖ **Change password** - Change password from web interface
- ‚úÖ **Password reset** - Command-line password reset tool
- ‚úÖ **Optional** - Can be disabled if not needed
- ‚úÖ **Logout** - Clear session and return to login

## üöÄ Quick Start

### 1. Set Up Password (First Time)

```bash
python setup_password.py
```

This sets the **default password: `admin123`**

### 2. Login to Web Interface

1. Open browser: `http://192.168.1.33:9000`
2. Enter password: `admin123`
3. Click "Login"

### 3. Change Password (Recommended!)

1. Click "Change Password" button
2. Enter current password: `admin123`
3. Enter new password (minimum 6 characters)
4. Confirm new password
5. Click "Change Password"

## üìù How It Works

### Architecture

```
User ‚Üí Login Page ‚Üí Verify Password
                          ‚Üì
                    Create Session
                          ‚Üì
                    Dashboard (Protected)
                          ‚Üì
                    All Pages (Protected)
```

### Password Storage

```
Plain Password ‚Üí Bcrypt Hash ‚Üí Stored in .env
   "admin123"  ‚Üí "$2b$12$..." ‚Üí PASSWORD_HASH=$2b$12$...
```

**Security:**
- Passwords are NEVER stored in plain text
- Only bcrypt hash is stored in `.env` file
- Hash is verified on each login
- Session token stored in browser cookie

### Session Management

- **Login**: Creates encrypted session cookie
- **Authenticated**: Session checked on every page
- **Logout**: Clears session and redirects to login
- **Timeout**: Session persists until explicit logout

## üîß Configuration

### In `.env` file:

```bash
# Enable/disable authentication
WEB_AUTH_ENABLED=true

# Password hash (generated by setup_password.py)
PASSWORD_HASH=$2b$12$abcdef...

# Secret key for session encryption (random string)
SECRET_KEY=your-random-secret-key-here
```

### Enable/Disable Authentication

**Disable (Not Recommended):**
```bash
WEB_AUTH_ENABLED=false
```

**Enable (Default and Recommended):**
```bash
WEB_AUTH_ENABLED=true
```

## üõ†Ô∏è Password Management

### Set Initial Password

```bash
# Default password (admin123)
python setup_password.py

# Custom password
python setup_password.py your_password
```

### Change Password (Web Interface)

1. Login to web interface
2. Click "üîë Change Password" button
3. Fill in form:
   - Current Password
   - New Password (minimum 6 characters)
   - Confirm New Password
4. Click "Change Password"

### Reset Forgotten Password

```bash
# Reset to admin123
python setup_password.py

# Set new password
python setup_password.py newpassword
```

This will update the `.env` file with the new password hash.

## üé® User Interface

### Login Page

- Clean, modern design
- Single password field
- Error messages for failed attempts
- Responsive (works on mobile)

### Dashboard (After Login)

- Header shows system name
- "Change Password" button (top right)
- "Logout" button (top right)
- Full access to all features

### Change Password Page

- Current password verification
- New password requirements
- Confirmation field
- Success/error messages
- Cancel button to return

## üîí Security Best Practices

### 1. Change Default Password Immediately

```bash
# After first setup, change from admin123
python setup_password.py strong_password_here
```

Or use the web interface "Change Password" feature.

### 2. Use Strong Passwords

**Good:**
- `MySecure2024Pass!`
- `Camera$ystem#2024`
- `Str0ng!P@ssw0rd`

**Bad:**
- `admin`
- `password`
- `123456`

**Requirements:**
- Minimum 6 characters (8+ recommended)
- Mix letters, numbers, symbols
- Avoid common words
- Don't reuse passwords

### 3. Protect Your .env File

```bash
# Check permissions
ls -la .env

# Set to read-only for owner
chmod 600 .env
```

**Never:**
- Commit `.env` to git (already in `.gitignore`)
- Share `.env` file
- Store password hash publicly

### 4. Use HTTPS in Production

For production deployments, use HTTPS:

```bash
# Example with nginx reverse proxy
server {
    listen 443 ssl;
    server_name camera.example.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://localhost:9000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 5. Limit Network Access

```bash
# Firewall: Only allow specific IPs
sudo ufw allow from 192.168.1.0/24 to any port 9000

# Or bind to localhost only (local access only)
# In .env:
BIND_IP=127.0.0.1
```

### 6. Monitor Login Attempts

```bash
# Check logs for failed logins
grep "Failed login" camera_system.log

# Check successful logins
grep "Successful login" camera_system.log
```

## üß™ Testing Authentication

### Test Login

1. Open browser to your server IP:port
2. Should see login page
3. Try wrong password ‚Üí Error message
4. Try correct password ‚Üí Dashboard

### Test Protected Routes

```bash
# Without login (should redirect)
curl http://192.168.1.33:9000/

# With session cookie (should work)
curl -b cookies.txt http://192.168.1.33:9000/
```

### Test Password Change

1. Login to web interface
2. Click "Change Password"
3. Enter:
   - Current: `admin123`
   - New: `newpassword123`
   - Confirm: `newpassword123`
4. Logout and login with new password

## üîç Troubleshooting

### Problem: Can't Login (Forgot Password)

**Solution:**
```bash
python setup_password.py newpassword
```

### Problem: "Invalid Password" Error

**Possible Causes:**
1. Wrong password
2. PASSWORD_HASH not set in .env
3. Corrupted password hash

**Solution:**
```bash
# Reset password
python setup_password.py admin123

# Check .env file has PASSWORD_HASH
cat .env | grep PASSWORD_HASH
```

### Problem: Redirected to Login After Logging In

**Possible Causes:**
1. SECRET_KEY not set
2. Browser blocking cookies
3. Session expired

**Solution:**
```bash
# Check SECRET_KEY in .env
cat .env | grep SECRET_KEY

# If empty, run:
python setup_password.py
```

### Problem: Authentication Disabled

**Check:**
```bash
cat .env | grep WEB_AUTH_ENABLED
```

**Should be:**
```bash
WEB_AUTH_ENABLED=true
```

### Problem: No Login Page (Direct to Dashboard)

Authentication is disabled. To enable:

```bash
# Edit .env
WEB_AUTH_ENABLED=true
PASSWORD_HASH=... (run setup_password.py if empty)
```

## üìä API Endpoints

| Endpoint | Auth Required | Description |
|----------|--------------|-------------|
| `/login` | No | Login page |
| `/logout` | No | Logout and clear session |
| `/` | Yes | Dashboard |
| `/change-password` | Yes | Change password page |
| `/api/status` | Yes | System status API |
| `/api/stats` | Yes | Statistics API |
| `/api/images` | Yes | Image list API |
| `/api/images/<file>` | Yes | Serve image file |
| `/api/capture/<camera>` | Yes | Manual capture API |
| `/api/cleanup/run` | Yes | Manual cleanup API |
| `/api/gpio/status` | Yes | GPIO status API |

## üéì Advanced Topics

### Multiple User Support

Currently single-user system. To add multiple users:

1. Create user database (SQLite)
2. Add username field to login
3. Store multiple password hashes
4. Add user management UI

### API Token Authentication

For programmatic access:

1. Generate API tokens
2. Store in database
3. Check token in API routes
4. Allow token-based authentication

### LDAP/Active Directory

For enterprise integration:

1. Install `python-ldap`
2. Add LDAP configuration
3. Verify credentials against LDAP
4. Fall back to local password if LDAP unavailable

### Two-Factor Authentication (2FA)

For enhanced security:

1. Install `pyotp` for TOTP
2. Add QR code generation
3. Store 2FA secrets
4. Verify TOTP code after password

## üìö Related Documentation

- [README.md](README.md) - Full system documentation
- [QUICKSTART.md](QUICKSTART.md) - Quick setup guide
- [OFFLINE_MODE.md](OFFLINE_MODE.md) - Offline operation details

## üéâ Summary

The authentication system provides:

- ‚úÖ **Simple** - Single password login
- ‚úÖ **Secure** - Bcrypt hashing, session management
- ‚úÖ **Flexible** - Can be enabled/disabled
- ‚úÖ **User-Friendly** - Easy password changes
- ‚úÖ **Protected** - All pages require login

**Default Password:** `admin123` (change immediately!)

**Change Password:** Web interface ‚Üí "Change Password" button

**Reset Password:** `python setup_password.py newpassword`

---

For more information, see the main [README.md](README.md) file.

